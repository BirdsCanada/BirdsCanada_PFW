<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Data Manipulation | Project FeederWatch: A Data Users Guide</title>
  <meta name="description" content="PWF data maniputations and statical summaries" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Data Manipulation | Project FeederWatch: A Data Users Guide" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://github.com/DMEthier/PFW.git/PFWbanner.png" />
  <meta property="og:description" content="PWF data maniputations and statical summaries" />
  <meta name="github-repo" content="DMEthier/PFW" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Data Manipulation | Project FeederWatch: A Data Users Guide" />
  
  <meta name="twitter:description" content="PWF data maniputations and statical summaries" />
  <meta name="twitter:image" content="https://github.com/DMEthier/PFW.git/PFWbanner.png" />

<meta name="author" content="Danielle Ethier" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Intro1.html"/>
<link rel="next" href="Zero3.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="mystyles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Project FeederWatch: A Data Users Guide</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="Intro1.html"><a href="Intro1.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Intro1.html"><a href="Intro1.html#intro1.1"><i class="fa fa-check"></i><b>1.1</b> Project FeederWatch</a></li>
<li class="chapter" data-level="1.2" data-path="Intro1.html"><a href="Intro1.html#intro1.2"><i class="fa fa-check"></i><b>1.2</b> Goal</a></li>
<li class="chapter" data-level="1.3" data-path="Intro1.html"><a href="Intro1.html#intro1.3"><i class="fa fa-check"></i><b>1.3</b> Getting Involved</a></li>
<li class="chapter" data-level="1.4" data-path="Intro1.html"><a href="Intro1.html#intro1.4"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="Intro1.html"><a href="Intro1.html#intro1.5"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Start2.html"><a href="Start2.html"><i class="fa fa-check"></i><b>2</b> Data Manipulation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Start2.html"><a href="Start2.html#Start2.1"><i class="fa fa-check"></i><b>2.1</b> Installing packages</a></li>
<li class="chapter" data-level="2.2" data-path="Start2.html"><a href="Start2.html#Start2.2"><i class="fa fa-check"></i><b>2.2</b> Working Directory</a></li>
<li class="chapter" data-level="2.3" data-path="Start2.html"><a href="Start2.html#Start2.3"><i class="fa fa-check"></i><b>2.3</b> Data download and filtering</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Zero3.html"><a href="Zero3.html"><i class="fa fa-check"></i><b>3</b> Zero-fill Matrix</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Zero3.html"><a href="Zero3.html#Zero3.1"><i class="fa fa-check"></i><b>3.1</b> Load Filtered Data</a></li>
<li class="chapter" data-level="3.2" data-path="Zero3.html"><a href="Zero3.html#Zero3.2"><i class="fa fa-check"></i><b>3.2</b> Species Range</a></li>
<li class="chapter" data-level="3.3" data-path="Zero3.html"><a href="Zero3.html#Zero3.3"><i class="fa fa-check"></i><b>3.3</b> Sampling Events</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Sum4.html"><a href="Sum4.html"><i class="fa fa-check"></i><b>4</b> Summary Statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Sum4.html"><a href="Sum4.html#Sum4.1"><i class="fa fa-check"></i><b>4.1</b> Average number of birds per week</a></li>
<li class="chapter" data-level="4.2" data-path="Sum4.html"><a href="Sum4.html#Sum4.2"><i class="fa fa-check"></i><b>4.2</b> Average number of species per week</a></li>
<li class="chapter" data-level="4.3" data-path="Sum4.html"><a href="Sum4.html#Sum4.3"><i class="fa fa-check"></i><b>4.3</b> Average number of species per site</a></li>
<li class="chapter" data-level="4.4" data-path="Sum4.html"><a href="Sum4.html#Sum4.4"><i class="fa fa-check"></i><b>4.4</b> Average group size when the species is present</a></li>
<li class="chapter" data-level="4.5" data-path="Sum4.html"><a href="Sum4.html#Sum4.5"><i class="fa fa-check"></i><b>4.5</b> Percent of sites with species at least once and mean group size</a></li>
<li class="chapter" data-level="4.6" data-path="Sum4.html"><a href="Sum4.html#Sum4.6"><i class="fa fa-check"></i><b>4.6</b> Top 10 Species</a></li>
<li class="chapter" data-level="4.7" data-path="Sum4.html"><a href="Sum4.html#Sum4.7"><i class="fa fa-check"></i><b>4.7</b> Plot Species Means</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Effort5.html"><a href="Effort5.html"><i class="fa fa-check"></i><b>5</b> Effort Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Effort5.html"><a href="Effort5.html#Effort5.1"><i class="fa fa-check"></i><b>5.1</b> Number of Sites Monitored</a></li>
<li class="chapter" data-level="5.2" data-path="Effort5.html"><a href="Effort5.html#Effort5.2"><i class="fa fa-check"></i><b>5.2</b> Number of Effort Days Monitored</a></li>
<li class="chapter" data-level="5.3" data-path="Effort5.html"><a href="Effort5.html#Effort5.3"><i class="fa fa-check"></i><b>5.3</b> Seasonal Effort</a></li>
<li class="chapter" data-level="5.4" data-path="Effort5.html"><a href="Effort5.html#Effort5.4"><i class="fa fa-check"></i><b>5.4</b> Supplemental Information</a></li>
<li class="chapter" data-level="5.5" data-path="Effort5.html"><a href="Effort5.html#Effort5.5"><i class="fa fa-check"></i><b>5.5</b> Housing and Population Denisty</a></li>
<li class="chapter" data-level="5.6" data-path="Effort5.html"><a href="Effort5.html#Effort5.6"><i class="fa fa-check"></i><b>5.6</b> Feeder Type</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Project FeederWatch: A Data Users Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Start2" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Data Manipulation<a href="Start2.html#Start2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this Chapter, we will import the raw data and wrangle it into a format suitable for creating summary statistics.</p>
<div id="Start2.1" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Installing packages<a href="Start2.html#Start2.1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The functionality of some packages may require updated versions of <a href="https://www.r-project.org/">R</a> and <a href="https://www.rstudio.com">RStudio</a>. To avoid errors, please ensure you are using the most recent releases of R and RStudio, and update your R packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="Start2.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">update.packages</span>()       </span>
<span id="cb1-2"><a href="Start2.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="Start2.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># may need to run this as an R administrator if you run into &#39;permission denied&#39; issues</span></span></code></pre></div>
<p>You need to load the package each time you open a new R session.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="Start2.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#If you need to install the package, use the following script before loading the package. You only need to install the package once on your computer, and then it will always be available. For example: </span></span>
<span id="cb2-2"><a href="Start2.html#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="Start2.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install.package(&quot;tidyverse&quot;)</span></span>
<span id="cb2-4"><a href="Start2.html#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="Start2.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tidyverse)</span>
<span id="cb2-6"><a href="Start2.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(lubridate)</span>
<span id="cb2-7"><a href="Start2.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(data.table)</span>
<span id="cb2-8"><a href="Start2.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(reshape)</span>
<span id="cb2-9"><a href="Start2.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tibble)</span></code></pre></div>
</div>
<div id="Start2.2" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Working Directory<a href="Start2.html#Start2.2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First, lets set up your working directory. If you don’t know what your current working directory is you can check with the following script.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="Start2.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p>If you want to save your data in a particular location on your computer, set your directory with the following script.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="Start2.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is just an example that will need to be modified to the path on your computer</span></span>
<span id="cb4-2"><a href="Start2.html#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="Start2.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/username/Documents/foldername/&quot;</span>)</span></code></pre></div>
<p>Alternatively, you can set the working directory using the <code>Session</code> tab &gt; <code>Set Working Directory</code> &gt; <code>Choose Directory</code></p>
<p>Now we will a create folder to save the raw data and store any outputs. We will also set shortcuts to these folders for future use.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="Start2.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;Data&quot;</span>)</span>
<span id="cb5-2"><a href="Start2.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;Output&quot;</span>)</span>
<span id="cb5-3"><a href="Start2.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="Start2.html#cb5-4" aria-hidden="true" tabindex="-1"></a>out.dir <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Output/&quot;</span>)</span>
<span id="cb5-5"><a href="Start2.html#cb5-5" aria-hidden="true" tabindex="-1"></a>dat.dir <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Data/&quot;</span>)</span></code></pre></div>
</div>
<div id="Start2.3" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Data download and filtering<a href="Start2.html#Start2.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Researchers seeking to conduct formal analyses using PFW data are invited to download the raw data from the Cornell Lab PFW <a href="https://feederwatch.org/explore/raw-dataset-requests/">website</a>. As with the use of any data set, knowing the data structure, understanding the metadata, grasping the data collection protocols, and being cognizant of the unique aspects of the program are all critical for conducting analyses and interpreting results in ways that provide meaningful insights. Although the data are freely available, we invite researchers to consult with researchers at the Cornell Lab of Ornithology or Birds Canada to ensure that the data are being handled and analyzed in a meaningful way.</p>
<blockquote>
<p>Save the raw data in the “Data” folder you created in the previous step. In this example, we are going to work with all the Canadian PFW data. This is a <em>big</em> dataset, so we will process it in batches, otherwise R gets cranky.</p>
</blockquote>
<p><strong>Step 1: Load Data</strong></p>
<p>Now that you have all the raw data saved in your <code>Data</code> folder, we are going to process each file sequentially to extract what we need. Each time you load a new dataframe you will overwrite the old ‘canada.pfw’ dataframe.</p>
<blockquote>
<p>Notice we are using <code>fread</code> instead of <code>read.csv</code>. It is faster for big data files.</p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="Start2.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Process sequentially. Load one file and move to Step 2.</span></span>
<span id="cb6-2"><a href="Start2.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="Start2.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Old data</span></span>
<span id="cb6-4"><a href="Start2.html#cb6-4" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_1988_1995_public.csv&quot;</span>)</span>
<span id="cb6-5"><a href="Start2.html#cb6-5" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_1996_2000_public.csv&quot;</span>)</span>
<span id="cb6-6"><a href="Start2.html#cb6-6" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_2001_2005_public.csv&quot;</span>)</span>
<span id="cb6-7"><a href="Start2.html#cb6-7" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_2006_2010_public.csv&quot;</span>)</span>
<span id="cb6-8"><a href="Start2.html#cb6-8" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_2011_2015_public.csv&quot;</span>)</span>
<span id="cb6-9"><a href="Start2.html#cb6-9" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_2016_2020_public.csv&quot;</span>)</span>
<span id="cb6-10"><a href="Start2.html#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="Start2.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#New data</span></span>
<span id="cb6-12"><a href="Start2.html#cb6-12" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_2021_public.csv&quot;</span>)</span>
<span id="cb6-13"><a href="Start2.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#New data 2021-2022 from Cornell. Just Canadian data for analysis. </span></span>
<span id="cb6-14"><a href="Start2.html#cb6-14" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_2021_2022.csv&quot;</span>)</span></code></pre></div>
<p><strong>Step 2: Filter Data</strong></p>
<p>Now that you have loaded your first dataframe filled with PFW data. Now we are going to filter and clean the data to ensure it is ready for future processing and analysis.</p>
<p>Change the uppercase headers to lower case, since it appears that there is a mix of both, depending on the year.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="Start2.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(canada.pfw)<span class="ot">&lt;-</span><span class="fu">tolower</span>(<span class="fu">names</span>(canada.pfw))</span></code></pre></div>
<p>Filter out the U.S. data and retain the Canadian data only. I also remove unwanted data columns. You can change this code to filter for just U.S. data, or to remove/ maintain any data column you would like for your analytical purposes.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="Start2.html#cb8-1" aria-hidden="true" tabindex="-1"></a>canada.pfw <span class="ot">&lt;-</span> canada.pfw <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="Start2.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subnational1_code <span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;CA-ON&quot;</span>,<span class="st">&quot;CA-SK&quot;</span>,<span class="st">&quot;CA-BC&quot;</span>,<span class="st">&quot;CA-QC&quot;</span>,<span class="st">&quot;CA-MB&quot;</span>,<span class="st">&quot;CA-AB&quot;</span>,<span class="st">&quot;CA-NB&quot;</span>,<span class="st">&quot;CA-NS&quot;</span>,<span class="st">&quot;CA-NL&quot;</span>,<span class="st">&quot;CA-PE&quot;</span>,<span class="st">&quot;CA-YT&quot;</span>,<span class="st">&quot;CA-NT&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="Start2.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>entry_technique, <span class="sc">-</span>data_entry_method) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="Start2.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code></pre></div>
<p>Here I separate the provincial code into its own column and remove ‘pfw’ from the Period id</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="Start2.html#cb9-1" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span>canada.pfw <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="Start2.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(subnational1_code, <span class="fu">c</span>(<span class="st">&quot;del1&quot;</span>, <span class="st">&quot;Prov&quot;</span>), <span class="at">sep=</span><span class="st">&quot;-&quot;</span>, <span class="at">remove=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="Start2.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span> (<span class="sc">-</span>del1, <span class="sc">-</span>subnational1_code) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="Start2.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(proj_period_id, <span class="fu">c</span>(<span class="st">&quot;del2&quot;</span>, <span class="st">&quot;Period&quot;</span>), <span class="at">sep=</span><span class="st">&quot;_&quot;</span>, <span class="at">remove=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="Start2.html#cb9-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>del2, <span class="sc">-</span>proj_period_id)</span></code></pre></div>
<p>To eliminate biases created by extending the PFW season in some years, data are truncated to after Nov 8 (doy=312) (the earliest possible 2nd Saturday) and end Apr 3 (doy=93) (earliest possible end date).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="Start2.html#cb10-1" aria-hidden="true" tabindex="-1"></a> canada.pfw <span class="ot">&lt;-</span> canada.pfw <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="Start2.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(<span class="fu">paste</span>(year, month, day, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)), <span class="at">doy =</span> <span class="fu">yday</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="Start2.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(doy <span class="sc">&lt;=</span> <span class="dv">93</span> <span class="sc">|</span> doy <span class="sc">&gt;=</span> <span class="dv">312</span>)</span></code></pre></div>
<p>Now we assign a <code>floor.week</code> variable which starts on Saturday (i.e., +6)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="Start2.html#cb11-1" aria-hidden="true" tabindex="-1"></a>canada.pfw <span class="ot">&lt;-</span> canada.pfw <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">floor.week=</span><span class="fu">floor_date</span>(canada.pfw<span class="sc">$</span>date,<span class="at">unit=</span><span class="st">&quot;week&quot;</span>)<span class="sc">+</span><span class="dv">6</span>)</span></code></pre></div>
<p>We also assign <code>region</code> to the Canadian data set since several provinces are grouped for the purpose of summary statistics.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="Start2.html#cb12-1" aria-hidden="true" tabindex="-1"></a>canada.pfw <span class="ot">&lt;-</span> canada.pfw <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="Start2.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;ON&quot;</span>, <span class="st">&quot;ON&quot;</span>, <span class="fu">ifelse</span> (Prov<span class="sc">==</span><span class="st">&quot;BC&quot;</span>, <span class="st">&quot;BC&quot;</span>, <span class="fu">ifelse</span>(Prov <span class="sc">==</span> <span class="st">&quot;AB&quot;</span>, <span class="st">&quot;PR&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;SK&quot;</span>, <span class="st">&quot;PR&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;MB&quot;</span>, <span class="st">&quot;PR&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;QC&quot;</span>, <span class="st">&quot;QC&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;NB&quot;</span>, <span class="st">&quot;AT&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;NS&quot;</span>, <span class="st">&quot;AT&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;PE&quot;</span>, <span class="st">&quot;AT&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;NL&quot;</span>, <span class="st">&quot;AT&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;YT&quot;</span>, <span class="st">&quot;North&quot;</span>, <span class="fu">ifelse</span>(Prov<span class="sc">==</span><span class="st">&quot;NT&quot;</span>, <span class="st">&quot;North&quot;</span>, <span class="cn">NA</span>)))))))))))))</span></code></pre></div>
<p>Now, we need to remove invalid records as defined by <a href="https://www.frontiersin.org/articles/10.3389/fevo.2021.619682/full">Bonter and Greig 2021</a>.</p>
<p>Flagged observations are identiﬁed in the database as “0” in the VALID ﬁeld and their status in the review process is described using a combination of the VALID ﬁeld and the REVIEWED ﬁeld as deﬁned here:</p>
<p>VALID = 0; REVIEWED = 0; Interpretation: Observation triggered a ﬂag by the automated system and awaits the review process. Note that such observations are removed.</p>
<p>VALID = 0; REVIEWED = 1; Interpretation: Observation triggered a ﬂag by the automated system and was reviewed; insuﬃcient evidence was provided to conﬁrm the observation. Note that such observations are removed.</p>
<p>VALID = 1; REVIEWED = 0; Interpretation: Observation did not trigger the automatic ﬂagging system and was accepted into the database without review.</p>
<p>VALID = 1; REVIEWED = 1; Interpretation: Observation triggered the ﬂagging system and was approved by an expert reviewer.</p>
<p>Based on these descriptions, we remove all VALID == 0, keep all VALID == 1. We do not use the REVIEW column at this time.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="Start2.html#cb13-1" aria-hidden="true" tabindex="-1"></a>canada.pfw <span class="ot">&lt;-</span> canada.pfw <span class="sc">%&gt;%</span> <span class="fu">filter</span>(valid<span class="sc">==</span><span class="dv">1</span>)</span></code></pre></div>
<p><strong>Step 3: Assign Species</strong></p>
<p>Before we proceed we are going to add some data columns that will help us with reporting. Specifically, we want to include the <code>REPORT_AS</code>, <code>CATEGORY</code> and <code>PRIMARY_COM_NAME</code> fields in the <code>PFW_species_code.csv</code>, which is part of the <a href="https://drive.google.com/file/d/1kHmx2XhA2MJtEyTNMpwqTQEnoa9M7Il2/view">PFW Data Dictionary</a>.
This csv file is located in the <code>Data</code> folder on GitHub or can be accessed directly at the link provided. However, note that the csv file provided on Github has been cleaned to only retain the worksheet/ data columns we need.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="Start2.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the PFW species list</span></span>
<span id="cb14-2"><a href="Start2.html#cb14-2" aria-hidden="true" tabindex="-1"></a>sp<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/PFW_species_codes.csv&quot;</span>)</span>
<span id="cb14-3"><a href="Start2.html#cb14-3" aria-hidden="true" tabindex="-1"></a>sp<span class="ot">&lt;-</span> sp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(SPECIES_CODE, REPORT_AS, CATEGORY, PRIMARY_COM_NAME)</span>
<span id="cb14-4"><a href="Start2.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="Start2.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the tables by species_code</span></span>
<span id="cb14-6"><a href="Start2.html#cb14-6" aria-hidden="true" tabindex="-1"></a>canada.pfw<span class="ot">&lt;-</span><span class="fu">left_join</span>(canada.pfw, sp, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;species_code&quot;</span><span class="ot">=</span><span class="st">&quot;SPECIES_CODE&quot;</span>))</span></code></pre></div>
<p><strong>Step 4: Save Data</strong></p>
<p>Now that you have processed the data that you want, you can save it locally in your <code>Data</code> folder. Since we process each raw data file in sequence, each will have its own unique file name.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="Start2.html#cb15-1" aria-hidden="true" tabindex="-1"></a>min.yr<span class="ot">&lt;-</span><span class="fu">min</span>(canada.pfw<span class="sc">$</span>year)</span>
<span id="cb15-2"><a href="Start2.html#cb15-2" aria-hidden="true" tabindex="-1"></a>max.yr<span class="ot">&lt;-</span><span class="fu">max</span>(canada.pfw<span class="sc">$</span>year)</span>
<span id="cb15-3"><a href="Start2.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-4"><a href="Start2.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(canada.pfw, <span class="at">file =</span> <span class="fu">paste</span>(dat.dir,<span class="st">&quot;PFW_Canada_&quot;</span>,min.yr,<span class="st">&quot;-&quot;</span>,max.yr, <span class="st">&quot;.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">col.name =</span> <span class="cn">TRUE</span>, <span class="at">append =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<p><strong>Step 5: Start Again</strong></p>
<p>Assuming you want to work with more than one data file, start back at <a href="Start2.html#Start2.3">Step One</a> and process the next raw data file. Once you are done processing your data, you can move to <a href="Zero3.html#Zero3">Chapter 3</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Intro1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Zero3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
