<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Zero-fill Matrix | Project FeederWatch: A Data Users Guide</title>
  <meta name="description" content="PWF data maniputations and statical summaries" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Zero-fill Matrix | Project FeederWatch: A Data Users Guide" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://github.com/DMEthier/PFW.git/PFWbanner.png" />
  <meta property="og:description" content="PWF data maniputations and statical summaries" />
  <meta name="github-repo" content="DMEthier/PFW" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Zero-fill Matrix | Project FeederWatch: A Data Users Guide" />
  
  <meta name="twitter:description" content="PWF data maniputations and statical summaries" />
  <meta name="twitter:image" content="https://github.com/DMEthier/PFW.git/PFWbanner.png" />

<meta name="author" content="Danielle Ethier" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Start2.html"/>
<link rel="next" href="Sum4.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="mystyles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Project FeederWatch: A Data Users Guide</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="Intro1.html"><a href="Intro1.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Intro1.html"><a href="Intro1.html#intro1.1"><i class="fa fa-check"></i><b>1.1</b> Project FeederWatch</a></li>
<li class="chapter" data-level="1.2" data-path="Intro1.html"><a href="Intro1.html#intro1.2"><i class="fa fa-check"></i><b>1.2</b> Goal</a></li>
<li class="chapter" data-level="1.3" data-path="Intro1.html"><a href="Intro1.html#intro1.3"><i class="fa fa-check"></i><b>1.3</b> Getting Involved</a></li>
<li class="chapter" data-level="1.4" data-path="Intro1.html"><a href="Intro1.html#intro1.4"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="Intro1.html"><a href="Intro1.html#intro1.5"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Start2.html"><a href="Start2.html"><i class="fa fa-check"></i><b>2</b> Data Manipulation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Start2.html"><a href="Start2.html#Start2.1"><i class="fa fa-check"></i><b>2.1</b> Installing packages</a></li>
<li class="chapter" data-level="2.2" data-path="Start2.html"><a href="Start2.html#Start2.2"><i class="fa fa-check"></i><b>2.2</b> Working Directory</a></li>
<li class="chapter" data-level="2.3" data-path="Start2.html"><a href="Start2.html#Start2.3"><i class="fa fa-check"></i><b>2.3</b> Data download and filtering</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Zero3.html"><a href="Zero3.html"><i class="fa fa-check"></i><b>3</b> Zero-fill Matrix</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Zero3.html"><a href="Zero3.html#Zero3.1"><i class="fa fa-check"></i><b>3.1</b> Load Filtered Data</a></li>
<li class="chapter" data-level="3.2" data-path="Zero3.html"><a href="Zero3.html#Zero3.2"><i class="fa fa-check"></i><b>3.2</b> Species Range</a></li>
<li class="chapter" data-level="3.3" data-path="Zero3.html"><a href="Zero3.html#Zero3.3"><i class="fa fa-check"></i><b>3.3</b> Sampling Events</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Sum4.html"><a href="Sum4.html"><i class="fa fa-check"></i><b>4</b> Summary Statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Sum4.html"><a href="Sum4.html#Sum4.1"><i class="fa fa-check"></i><b>4.1</b> Average number of birds per week</a></li>
<li class="chapter" data-level="4.2" data-path="Sum4.html"><a href="Sum4.html#Sum4.2"><i class="fa fa-check"></i><b>4.2</b> Average number of species per week</a></li>
<li class="chapter" data-level="4.3" data-path="Sum4.html"><a href="Sum4.html#Sum4.3"><i class="fa fa-check"></i><b>4.3</b> Average number of species per site</a></li>
<li class="chapter" data-level="4.4" data-path="Sum4.html"><a href="Sum4.html#Sum4.4"><i class="fa fa-check"></i><b>4.4</b> Average group size when the species is present</a></li>
<li class="chapter" data-level="4.5" data-path="Sum4.html"><a href="Sum4.html#Sum4.5"><i class="fa fa-check"></i><b>4.5</b> Percent of sites with species at least once and mean group size</a></li>
<li class="chapter" data-level="4.6" data-path="Sum4.html"><a href="Sum4.html#Sum4.6"><i class="fa fa-check"></i><b>4.6</b> Top 10 Species</a></li>
<li class="chapter" data-level="4.7" data-path="Sum4.html"><a href="Sum4.html#Sum4.7"><i class="fa fa-check"></i><b>4.7</b> Plot Species Means</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Effort5.html"><a href="Effort5.html"><i class="fa fa-check"></i><b>5</b> Effort Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Effort5.html"><a href="Effort5.html#Effort5.1"><i class="fa fa-check"></i><b>5.1</b> Number of Sites Monitored</a></li>
<li class="chapter" data-level="5.2" data-path="Effort5.html"><a href="Effort5.html#Effort5.2"><i class="fa fa-check"></i><b>5.2</b> Number of Effort Days Monitored</a></li>
<li class="chapter" data-level="5.3" data-path="Effort5.html"><a href="Effort5.html#Effort5.3"><i class="fa fa-check"></i><b>5.3</b> Seasonal Effort</a></li>
<li class="chapter" data-level="5.4" data-path="Effort5.html"><a href="Effort5.html#Effort5.4"><i class="fa fa-check"></i><b>5.4</b> Supplemental Information</a></li>
<li class="chapter" data-level="5.5" data-path="Effort5.html"><a href="Effort5.html#Effort5.5"><i class="fa fa-check"></i><b>5.5</b> Housing and Population Denisty</a></li>
<li class="chapter" data-level="5.6" data-path="Effort5.html"><a href="Effort5.html#Effort5.6"><i class="fa fa-check"></i><b>5.6</b> Feeder Type</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Project FeederWatch: A Data Users Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Zero3" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Zero-fill Matrix<a href="Zero3.html#Zero3" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Many analyses require that you have records not only of when/where species were detected, but also where they were not detected. PFW contains records of species presence, however, we can infer species absence when a species was not detected during a survey, if the survey was done within the bounds of the species range.</p>
<blockquote>
<p>Let’s start this Chapter by reloading our libraries and resetting our working directories in the event you took a break and are starting a new session with your newly filtered and cleaned data set.</p>
</blockquote>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="Zero3.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tidyverse)</span>
<span id="cb16-2"><a href="Zero3.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(reshape)</span>
<span id="cb16-3"><a href="Zero3.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(data.table)</span>
<span id="cb16-4"><a href="Zero3.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tibble)</span>
<span id="cb16-5"><a href="Zero3.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(raster)</span>
<span id="cb16-6"><a href="Zero3.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(sp)</span>
<span id="cb16-7"><a href="Zero3.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(rgeos)</span>
<span id="cb16-8"><a href="Zero3.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(rgdal)</span>
<span id="cb16-9"><a href="Zero3.html#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="Zero3.html#cb16-10" aria-hidden="true" tabindex="-1"></a>out.dir <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Output/&quot;</span>)</span>
<span id="cb16-11"><a href="Zero3.html#cb16-11" aria-hidden="true" tabindex="-1"></a>dat.dir <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Data/&quot;</span>)</span></code></pre></div>
<div id="Zero3.1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Load Filtered Data<a href="Zero3.html#Zero3.1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First we will load each of the filtered and cleaned PFW dataset into your working Environment under a different dateframe name.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="Zero3.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Old data</span></span>
<span id="cb17-2"><a href="Zero3.html#cb17-2" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_1988-1995.csv&quot;</span>)</span>
<span id="cb17-3"><a href="Zero3.html#cb17-3" aria-hidden="true" tabindex="-1"></a>dat2<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_1995-2000.csv&quot;</span>)</span>
<span id="cb17-4"><a href="Zero3.html#cb17-4" aria-hidden="true" tabindex="-1"></a>dat3<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_2000-2005.csv&quot;</span>)</span>
<span id="cb17-5"><a href="Zero3.html#cb17-5" aria-hidden="true" tabindex="-1"></a>dat4<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_2005-2010.csv&quot;</span>)</span>
<span id="cb17-6"><a href="Zero3.html#cb17-6" aria-hidden="true" tabindex="-1"></a>dat5<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_2010-2015.csv&quot;</span>)</span>
<span id="cb17-7"><a href="Zero3.html#cb17-7" aria-hidden="true" tabindex="-1"></a>dat6<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_2015-2020.csv&quot;</span>)</span>
<span id="cb17-8"><a href="Zero3.html#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="Zero3.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#New data</span></span>
<span id="cb17-10"><a href="Zero3.html#cb17-10" aria-hidden="true" tabindex="-1"></a>dat7<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_2020-2021.csv&quot;</span>)</span>
<span id="cb17-11"><a href="Zero3.html#cb17-11" aria-hidden="true" tabindex="-1"></a>dat8<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;Data/PFW_Canada_2021-2022.csv&quot;</span>)</span></code></pre></div>
<p>Notice that the newest dateset provided by Cornell Labs is missing the <code>plus_code</code> (i.e., dat7 has one fewer column). We will add this column in the right spot to make the bind possible.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="Zero3.html#cb18-1" aria-hidden="true" tabindex="-1"></a>dat7<span class="ot">&lt;-</span><span class="fu">add_column</span>(dat7, <span class="at">plus_code =</span> <span class="dv">0</span>, <span class="at">.after =</span> <span class="dv">12</span>)</span>
<span id="cb18-2"><a href="Zero3.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="Zero3.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Data directly from Cornell formatted slightly differently. </span></span>
<span id="cb18-4"><a href="Zero3.html#cb18-4" aria-hidden="true" tabindex="-1"></a>dat8<span class="ot">&lt;-</span>dat8 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>alt_full_spp_code, <span class="sc">-</span>user_id, <span class="sc">-</span>observer_id, <span class="sc">-</span>housing_density, <span class="sc">-</span>no_birds)</span></code></pre></div>
<p>Bind and write your full Canadian PFW dataset to the <code>Data</code> directory for use later in the analysis</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="Zero3.html#cb19-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">rbind</span>(dat1, dat2, dat3, dat4, dat5, dat6, dat7, dat8)</span>
<span id="cb19-2"><a href="Zero3.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="Zero3.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(data, <span class="fu">paste</span>(dat.dir,<span class="st">&quot;PFW_Canada_All.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">col.name =</span> <span class="cn">TRUE</span>, <span class="at">append =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
</div>
<div id="Zero3.2" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Species Range<a href="Zero3.html#Zero3.2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will zero-fill the data two different ways. Why? because one way is used for standardized reporting by Cornell and Birds Canada, and the second way is more biologically appropriate and should be adopted for research purposes.</p>
<p>For reporting purposes, we will zero-fill the data matrix based on Province (or State). Specifically, if a species was detected &gt;10 time in the past 10 years within a specific Province, it will be considered in range.</p>
<p>First, lets create the zero-fill range file for each Province. First, we creating a master list that links all <code>loc_id</code> from PFW to Province, the we determine if a species was detected &gt;=10 times. This is done using a loop, which creates a Range output table. Note that we use the <code>REPORT_AS</code> for the species ID field, <em>not</em> <code>species_code</code> (which would at first glance seems to make sense, but in the long run it doesn’t work out. Trust me!).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="Zero3.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the past 10 years of data to assign range limits for species</span></span>
<span id="cb20-2"><a href="Zero3.html#cb20-2" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year<span class="sc">&gt;=</span><span class="dv">2010</span>)</span>
<span id="cb20-3"><a href="Zero3.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="Zero3.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicated and NA</span></span>
<span id="cb20-5"><a href="Zero3.html#cb20-5" aria-hidden="true" tabindex="-1"></a>master<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Prov) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() </span>
<span id="cb20-6"><a href="Zero3.html#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="Zero3.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Write table to your output director for safe keeping. You will use the master list later. </span></span>
<span id="cb20-8"><a href="Zero3.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(master, <span class="at">file =</span> <span class="fu">paste</span>(out.dir, <span class="st">&quot;master_prov.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb20-9"><a href="Zero3.html#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="Zero3.html#cb20-10" aria-hidden="true" tabindex="-1"></a>sp.list<span class="ot">&lt;-</span><span class="fu">unique</span>(data<span class="sc">$</span>REPORT_AS) <span class="co"># n = 303 in this example</span></span>
<span id="cb20-11"><a href="Zero3.html#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="Zero3.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a species loop</span></span>
<span id="cb20-13"><a href="Zero3.html#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sp.list)) {</span>
<span id="cb20-14"><a href="Zero3.html#cb20-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-15"><a href="Zero3.html#cb20-15" aria-hidden="true" tabindex="-1"></a> <span class="co"># m&lt;-1 #for testing each species</span></span>
<span id="cb20-16"><a href="Zero3.html#cb20-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb20-17"><a href="Zero3.html#cb20-17" aria-hidden="true" tabindex="-1"></a>  sp.data <span class="ot">&lt;-</span><span class="cn">NULL</span> </span>
<span id="cb20-18"><a href="Zero3.html#cb20-18" aria-hidden="true" tabindex="-1"></a>  sp.data <span class="ot">&lt;-</span> <span class="fu">filter</span>(dat, REPORT_AS <span class="sc">==</span> sp.list[m]) <span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="Zero3.html#cb20-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">droplevels</span>()</span>
<span id="cb20-20"><a href="Zero3.html#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="Zero3.html#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of observation in each Atlas Block  </span></span>
<span id="cb20-22"><a href="Zero3.html#cb20-22" aria-hidden="true" tabindex="-1"></a>  sp.data<span class="ot">&lt;-</span>sp.data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Prov) <span class="sc">%&gt;%</span></span>
<span id="cb20-23"><a href="Zero3.html#cb20-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">nobs=</span><span class="fu">length</span>(how_many)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-24"><a href="Zero3.html#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">count=</span><span class="fu">ifelse</span>(nobs<span class="sc">&gt;=</span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-25"><a href="Zero3.html#cb20-25" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>nobs)</span>
<span id="cb20-26"><a href="Zero3.html#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="Zero3.html#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(sp.data)[<span class="fu">colnames</span>(sp.data) <span class="sc">==</span> <span class="st">&quot;count&quot;</span>] <span class="ot">&lt;-</span> sp.list[m]</span>
<span id="cb20-28"><a href="Zero3.html#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="Zero3.html#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Optional: if there are less than 2 Atlas Blocks containing a record of a species, remove. Considered rare and/or out of range. </span></span>
<span id="cb20-30"><a href="Zero3.html#cb20-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-31"><a href="Zero3.html#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co"># if(nrow(sp.data)&lt;2){</span></span>
<span id="cb20-32"><a href="Zero3.html#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co">#    sp.data&lt;-NULL</span></span>
<span id="cb20-33"><a href="Zero3.html#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co">#  }else{</span></span>
<span id="cb20-34"><a href="Zero3.html#cb20-34" aria-hidden="true" tabindex="-1"></a>master<span class="ot">&lt;-</span><span class="fu">left_join</span>(master, sp.data, <span class="at">by =</span> <span class="st">&quot;Prov&quot;</span> )</span>
<span id="cb20-35"><a href="Zero3.html#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co">#  } #end if statement</span></span>
<span id="cb20-36"><a href="Zero3.html#cb20-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-37"><a href="Zero3.html#cb20-37" aria-hidden="true" tabindex="-1"></a>} <span class="co">#end sp.list loop</span></span>
<span id="cb20-38"><a href="Zero3.html#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="Zero3.html#cb20-39" aria-hidden="true" tabindex="-1"></a>master[<span class="fu">is.na</span>(master)]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb20-40"><a href="Zero3.html#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="Zero3.html#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your new range table to an output file</span></span>
<span id="cb20-42"><a href="Zero3.html#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(master, <span class="at">file =</span> <span class="fu">paste</span>(out.dir, <span class="st">&quot;Range_prov.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<p>Each row under the species id indicates if the Atlas Block is within range (1) or is out of range (0).</p>
</div>
<div id="Zero3.3" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Sampling Events<a href="Zero3.html#Zero3.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we have a handle on the winter distribution/range of each species, we need to know when each PFW site was sampled. This way we only add a zero-count for a site that was being watched. This is done for each <code>sub_id</code> which covers the two-day count period.</p>
<p>First we create new effort fields. The first sums the number of half days the feeder site was watched (max = 4) and the second changes the effort hours into a factor.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="Zero3.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the full data table. This step is repetitive. </span></span>
<span id="cb21-2"><a href="Zero3.html#cb21-2" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">rbind</span>(dat1, dat2, dat3, dat4, dat5, dat6, dat7, dat8)</span>
<span id="cb21-3"><a href="Zero3.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="Zero3.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create effort days field (max = 4)</span></span>
<span id="cb21-5"><a href="Zero3.html#cb21-5" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Effort_days =</span> (day1_am <span class="sc">+</span>day1_pm <span class="sc">+</span>day2_am <span class="sc">+</span>day2_pm)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb21-6"><a href="Zero3.html#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="Zero3.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create effort hours field that is a factor</span></span>
<span id="cb21-8"><a href="Zero3.html#cb21-8" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Effort_hrs =</span> <span class="fu">as.factor</span>(effort_hrs_atleast))</span>
<span id="cb21-9"><a href="Zero3.html#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data<span class="sc">$</span>Effort_hrs)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;0_1&quot;</span>, <span class="st">&quot;1_4&quot;</span>, <span class="st">&quot;4_8&quot;</span>, <span class="st">&quot;&gt;8&quot;</span>)</span></code></pre></div>
<p>Now we are ready to create the full sampling events layer using the filtered Canadian PFW dataset.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="Zero3.html#cb22-1" aria-hidden="true" tabindex="-1"></a>event.data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="Zero3.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(loc_id, sub_id, latitude, longitude, month, day, year, Period, Effort_days, Effort_hrs, Prov, region) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="Zero3.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(loc_id, sub_id, latitude, longitude, month, day, year, Period, Effort_days, Effort_hrs, Prov, region) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="Zero3.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="Zero3.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="Zero3.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb22-7"><a href="Zero3.html#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="Zero3.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># write your new sampling events table to an Output folder</span></span>
<span id="cb22-9"><a href="Zero3.html#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(event.data, <span class="fu">paste</span>(out.dir,<span class="st">&quot;Events.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">col.name =</span> <span class="cn">TRUE</span>, <span class="at">append =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<p>Now you have the tables that you need to zero-fill your data matrix. We can now start creating data summaries in <a href="Sum4.html#Sum4">Chapter 4</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Start2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Sum4.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
